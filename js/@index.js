function addListener(e,n){window.addEventListener?window.addEventListener(e,n,!1):window.attachEvent("on"+e,n)}var require=function(){var e={};return function(n,t){var r;if(t=window["#"+n],"undefined"==typeof t){var o=new Error("Required module is missing: "+n);throw console.error(o.stack),o}if(r=e[n],"undefined"==typeof r){r={exports:{}};var i=r.exports;t(i,r),e[n]=r.exports,r=r.exports}return r}}();addListener("DOMContentLoaded",function(){document.body.parentNode.$data={},APP=require("main"),setTimeout(function(){"function"==typeof APP.start&&APP.start()})});
window["#$"]=function(n,e){n.config={name:"webgl-experiments",description:"WebGL experiments",author:"Tolokoban",version:"0.0.181",major:0,minor:0,revision:181,date:new Date(2016,1,8,13,53,11)};var r=null;n.lang=function(n){return void 0===n&&(n=window.localStorage.getItem("Language"),n||(n=window.navigator.language,n||(n=window.navigator.browserLanguage,n||(n="fr"))),n=n.substr(0,2).toLowerCase()),r=n,window.localStorage.setItem("Language",n),n},n.intl=function(e,r){var t,a,o,i,g,u,s=e[n.lang()],l=r[0];if(!s)return l;if(t=s[l],!t)return l;if(r.length>1){for(a="",g=0,o=0;o<t.length;o++)i=t.charAt(o),"$"===i?(a+=t.substring(g,o),o++,u=t.charCodeAt(o)-48,a+=0>u||u>=r.length?"$"+t.charAt(o):r[u],g=o+1):"\\"===i&&(a+=t.substring(g,o),o++,a+=t.charAt(o),g=o+1);a+=t.substr(g),t=a}return t}};
window["#main"]=function(e,n){function o(e){var n=e-b;if(g.applyRotation(T,n),g.applyRotation(q,n),b=e,g.rotation.speedX*=.95,g.rotation.speedY*=.95,!x.anim(e)&&g.tap()){var t=new THREE.Raycaster,r=new THREE.Vector3(g.x,g.y,1).unproject(u);t.set(u.position,r.sub(u.position).normalize());var i=t.intersectObjects(T.children),a=i.length>0?i[0].object:null;a&&x.tap(a,e)}requestAnimationFrame(o),d.render(c,u)}function t(e){"undefined"==typeof e&&(e=.5);var n=[new THREE.Color(0,1,0),new THREE.Color(0,1,1),new THREE.Color(0,0,1),new THREE.Color(1,0,0),new THREE.Color(1,1,0),new THREE.Color(1,0,1)],o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(e,e,e),new THREE.Vector3(e,e,-e),new THREE.Vector3(-e,e,-e),new THREE.Vector3(-e,e,e),new THREE.Vector3(e,-e,e),new THREE.Vector3(e,-e,-e),new THREE.Vector3(-e,-e,-e),new THREE.Vector3(-e,-e,e)),[[0,1,2,3],[0,4,5,1],[1,5,6,2],[2,6,7,3],[0,3,7,4],[4,7,6,5]].forEach(function(e,t){var r=new THREE.Face3(e[0],e[1],e[2]),i=new THREE.Face3(e[0],e[2],e[3]);r.vertexColors[0]=r.vertexColors[1]=r.vertexColors[2]=n[t],i.vertexColors[0]=i.vertexColors[1]=i.vertexColors[2]=n[t],o.faces.push(r,i)}),o.computeFaceNormals(),o.computeVertexNormals();var t=new THREE.MeshPhongMaterial({specular:1118481,shininess:2,vertexColors:THREE.VertexColors});return new THREE.Mesh(o,t)}var r=(require("$").intl,require("taquin.cube")),i=require("taquin.grid"),a=require("taquin.hollow-cube"),E=require("taquin.rotate-touch"),s=Math.min(window.innerWidth,window.innerHeight),l=s,c=new THREE.Scene,u=new THREE.PerspectiveCamera(35,s/l,.1,1e3),d=new THREE.WebGLRenderer;d.setSize(s,l),document.body.appendChild(d.domElement);var w=[],p={x:0,y:0};d.domElement.addEventListener("mousemove",function(e){p.x=e.clientX/s*2-1,p.y=2*-(e.clientY/l)+1}),d.domElement.addEventListener("mousedown",function(e){w.push("MOUSEDOWN")}),d.domElement.addEventListener("touchstart",function(e){p.x=e.clientX/s*2-1,p.y=2*-(e.clientY/l)+1,w.push("MOUSEDOWN")});var R,H=(new THREE.MeshPhongMaterial({color:16711680,specular:3355443,shininess:15,map:null,specularMap:null,normalMap:null}),new THREE.DirectionalLight(14540253,.8)),m=new THREE.DirectionalLight(10066431,.5),T=new THREE.Group;c.add(H),c.add(m);var v,h,C,f,x=new i(3,3,3);for(v=0;3>v;v++)for(h=0;3>h;h++)for(C=0;3>C;C++)(1!=v||1!=h||1!=C)&&(f=r(v,h,C),x.cube(v,h,C,f),T.add(f));R=f.material;var q=a(3),y=t();x.setHole(y),q.add(y);var V=new THREE.Group;V.add(T);var M=new THREE.Group;M.add(q),V.position.set(-.2,.2,-.5),M.position.set(1.7,-1.7,1),M.scale.set(.3,.3,.3),c.add(V),c.add(M),u.position.z=9,H.position.set(3,0,5),m.position.set(-1,2,4);var b=Date.now();T.rotation.x=0,T.rotation.y=0,T.rotation.z=0;var g=new E(d.domElement);requestAnimationFrame(o)};
window["#taquin.rotate-touch"]=function(t,e){var a=1,n=2,i=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),function(t){var e=this;this.x=0,this.y=0,this._tap=!1,this.rotation={speedX:.01*Math.random(),speedY:.01*Math.random()};var i=0,o=0,r=0;t.addEventListener("touchstart",function(a){a.preventDefault(),a.stopPropagation(),i=n,o=r=Date.now();var h=a.changedTouches;h.length>0&&(e.x=h[0].clientX/t.width*2-1,e.x0=e.x,e.y=2*-(h[0].clientY/t.height)+1,e.y0=e.y),e.rotation.speedX=e.rotation.speedY=0}),t.addEventListener("touchend",function(a){if(i==n){a.preventDefault(),a.stopPropagation();var r=Date.now()-o;if(!(r>400)){var h,s,p=a.changedTouches;p.length>0&&(h=p[0].clientX/t.width*2-1,s=2*-(p[0].clientY/t.height)+1);var d=Math.max(Math.abs(e.x0-h),Math.abs(e.y0-s));d>.05||(e._tap=!0)}}}),t.addEventListener("touchmove",function(a){if(i==n){a.preventDefault();var o,h,s=a.changedTouches;if(s.length>0){o=s[0].clientX/t.width*2-1,h=2*-(s[0].clientY/t.height)+1;var p=Date.now(),d=Math.max(.001,p-r);e.rotation.speedY=(o-e.x)/d,e.rotation.speedX=(h-e.y)/d,e.x=o,e.y=h,r=p}}}),t.addEventListener("mousedown",function(n){n.preventDefault(),n.stopPropagation(),i=a,o=r=Date.now(),e.x=n.clientX/t.width*2-1,e.x0=e.x,e.y=2*-(n.clientY/t.height)+1,e.y0=e.y,e.rotation.speedX=e.rotation.speedY=0}),t.addEventListener("mouseup",function(n){if(i==a){i=0,n.preventDefault(),n.stopPropagation();var r=Date.now()-o;if(!(r>400)){var h,s;h=n.clientX/t.width*2-1,s=2*-(n.clientY/t.height)+1;var p=Math.max(Math.abs(e.x0-h),Math.abs(e.y0-s));p>.05||(e._tap=!0)}}}),t.addEventListener("mousemove",function(n){if(i==a){n.preventDefault();var o,h;n.changedTouches;o=n.clientX/t.width*2-1,h=2*-(n.clientY/t.height)+1;var s=Date.now(),p=Math.max(.001,s-r);e.rotation.speedY=(o-e.x)/p,e.rotation.speedX=(h-e.y)/p,e.x=o,e.y=h,r=s}})});i.prototype.applyRotation=function(t,e){var a=this.rotation.speedX*e,n=-this.rotation.speedY*e,i=Math.cos(a),o=Math.sin(a),r=Math.cos(n),h=Math.sin(n);t.matrixAutoUpdate=!1;var s=new THREE.Matrix4,p=s.elements;p[0]=r,p[1]=0,p[2]=h,p[3]=0,p[4]=o*h,p[5]=i,p[6]=-r*o,p[7]=0,p[8]=-i*h,p[9]=o,p[10]=i*r,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,t.matrix=s.multiply(t.matrix)},i.prototype.tap=function(){return this._tap?(this._tap=!1,!0):!1},e.exports=i};
window["#taquin.hollow-cube"]=function(e,E){E.exports=function(e){"undefined"==typeof e&&(e=1);var E,n,o,r,t,w,i=new THREE.Group,H=new THREE.LineBasicMaterial({color:new THREE.Color(.5,.5,.5),linewidth:1}),R=new THREE.LineBasicMaterial({color:new THREE.Color(.1,.1,.1),linewidth:1}),T=e/2;for(o=0;4>o;o++)for(E=(o-1.5)*T/1.5,r=0;4>r;r++)n=(r-1.5)*T/1.5,w=0!=o&&3!=o||0!=r&&3!=r?R:H,t=new THREE.Geometry,t.vertices.push(new THREE.Vector3(E,n,-T),new THREE.Vector3(E,n,T)),i.add(new THREE.Line(t,w)),t=new THREE.Geometry,t.vertices.push(new THREE.Vector3(E,-T,n),new THREE.Vector3(E,T,n)),i.add(new THREE.Line(t,w)),t=new THREE.Geometry,t.vertices.push(new THREE.Vector3(-T,E,n),new THREE.Vector3(T,E,n)),i.add(new THREE.Line(t,w));return i}};
window["#taquin.grid"]=function(t,i){var s=1,e=2,n=function(t,i,s){this._cubes=[];for(var e=0;t*i*s>e;e++)this._cubes.push(null);this._dx=t,this._dy=i,this._dz=s,this._anim={start:0,end:0,cube:null,type:0,x0:0,x1:0,y0:0,y1:0,z0:0,z1:0}};n.prototype.setHole=function(t){this._hole=t},n.prototype.anim=function(t){var i=this._hole,e=this._anim;if(!e.cube)return!1;var n=e.end-e.start;if(e.type==s)if(t>=e.end)e.cube.scale.x=1,e.cube.scale.y=1,e.cube.scale.z=1,e.cube=null;else{var u=1-.75*Math.sin(Math.PI*(t-e.start)/n);e.cube.scale.x=e.cube.scale.y=e.cube.scale.z=u}else t>=e.end?(e.cube.position.x=e.x1,e.cube.position.y=e.y1,e.cube.position.z=e.z1,e.cube=null):(e.cube.position.x=e.x0+(e.x1-e.x0)*(t-e.start)/n,e.cube.position.y=e.y0+(e.y1-e.y0)*(t-e.start)/n,e.cube.position.z=e.z0+(e.z1-e.z0)*(t-e.start)/n),i&&(t>=e.end?(i.position.x=e.x0,i.position.y=e.y0,i.position.z=e.z0,i=null):(i.position.x=e.x1+(e.x0-e.x1)*(t-e.start)/n,i.position.y=e.y1+(e.y0-e.y1)*(t-e.start)/n,i.position.z=e.z1+(e.z0-e.z1)*(t-e.start)/n));return!0},n.prototype.tap=function(t,i){var n=this.find(t);if(n){var u=n.x,o=n.y,c=n.z,r=t.position.x,l=t.position.y,h=t.position.z,a=null;null===this.cube(u+1,o+0,c+0)?a=[1,0,0]:null===this.cube(u-1,o+0,c+0)?a=[-1,0,0]:null===this.cube(u+0,o+1,c+0)?a=[0,1,0]:null===this.cube(u+0,o-1,c+0)?a=[0,-1,0]:null===this.cube(u+0,o+0,c+1)?a=[0,0,1]:null===this.cube(u+0,o+0,c-1)&&(a=[0,0,-1]),a?(this._anim={cube:t,type:e,start:i,end:i+300,x0:r,y0:l,z0:h,x1:r+a[0],y1:l+a[1],z1:h+a[2]},this.cube(u+a[0],o+a[1],c+a[2],t),this.cube(u,o,c,null),console.info("[taquin.grid] this._anim=...",this._anim)):this._anim={cube:t,type:s,start:i,end:i+300}}},n.prototype.cube=function(t,i,s,e){if(!(0>t||0>i||0>s||t>2||i>2||s>2)){var n=Math.floor(t+i*this._dx+s*this._dx*this._dy);if(!(0>n||n>=this._cubes.length))return"undefined"==typeof e?this._cubes[n]:(this._cubes[n]=e,this)}},n.prototype.find=function(t){var i,s,e;for(e=0;e<this._dz;e++)for(s=0;s<this._dy;s++)for(i=0;i<this._dx;i++)if(t===this.cube(i,s,e))return{x:i,y:s,z:e};return null},i.exports=n};
window["#taquin.cube"]=function(t,e){function a(t,e){var a=document.createElement("canvas"),r=l,n=l;a.width=r,a.height=n;var i=a.getContext("2d");return i.fillStyle=e,i.fillRect(0,0,r,n),i.font="Bold "+Math.floor(3*r/4)+"px Arial",i.textAlign="center",i.textBaseline="middle",i.fillStyle="#000",i.fillText(t,r/2,n/2),a}function r(t,e){var r=new THREE.Texture(a(t,e));return r.needsUpdate=!0,r}function n(t){var e=document.createElement("canvas"),a=l,r=l;e.width=a,e.height=r;var n=e.getContext("2d");n.fillStyle="#000",n.fillRect(0,0,a,r),n.fillStyle="#777",n.fillRect(1,1,a-2,r-2);for(var i=Math.random()*e.width*2-e.width,h=Math.min(-i,0),c=Math.floor(122+4*Math.random());h<Math.max(e.width,e.width-i);)n.strokeStyle="rgb("+c+","+c+","+c+")",n.beginPath(),n.moveTo(h,0),n.lineTo(h+i,a),n.stroke(),h+=2+5*Math.random();n.font="Bold "+Math.floor(3*a/4)+"px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle="rgba(255, 255, 255, .3)";var h,f;for(f=-2;3>f;f++)for(h=-2;3>h;h++)n.fillText(t,a/2+h,r/2+f);var o=new THREE.Texture(e);return o.needsUpdate=!0,o}function i(t,e){return new THREE.MeshPhongMaterial({specular:3355443,shininess:25,transparent:!0,opacity:.6,map:r(t,e),specularMap:null,bumpMap:n(t)})}var l=128;e.exports=function(t,e,a){var r=[i(["abcdefghi".charAt(a+3*e)," ","IHGFEDCBA".charAt(a+3*e)][t],["#0ff","#8bb","#0bb"][t]),i(["IHGFEDCBA".charAt(2-a+3*e)," ","abcdefghi".charAt(2-a+3*e)][t],["#f00","#b44","#b00"][t]),i(["ihgfedcba".charAt(t+3*a)," ","ABCDEFGHI".charAt(t+3*a)][e],["#0f0","#4b4","#0b0"][e]),i(["IHGFEDCBA".charAt(2-t+3*a)," ","abcdefghi".charAt(2-t+3*a)][e],["#f0f","#b8b","#b0b"][e]),i(["abcdefghi".charAt(2-t+3*e)," ","IHGFEDCBA".charAt(2-t+3*e)][a],["#ff0","#bb8","#bb0"][a]),i(["IHGFEDCBA".charAt(t+3*e)," ","abcdefghi".charAt(t+3*e)][a],["#00f","#44b","#00b"][a])],n=new THREE.Mesh(new THREE.BoxGeometry(1,1,1,1,1,1),new THREE.MeshFaceMaterial(r));return n.position.set(t-1,e-1,a-1),n}};
//# sourceMappingURL=map/@index.js.map